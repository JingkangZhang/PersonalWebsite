<!DOCTYPE html>

<html>

<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Jingkang Zhang Writings</title>
    <link href="./index.css?v=4" type="text/css" rel="stylesheet" />
    <link href="./scrollIndicator.css" type="text/css" rel="stylesheet" />
    <link href="./csshake.css" type="text/css" rel="stylesheet" />


    <script src="./scrollmagic/ScrollMagic.min.js"></script>
    <script src="./scrollmagic/gsap.min.js"></script>
    <script src="./scrollmagic/animation.gsap.min.js"></script>
    <script src="./scrollmagic/debug.addIndicators.min.js"></script>

    <!-- <script  src="./scrollmagic/ScrollMagic.js"></script>
    <script  src="./scrollmagic/gsap-core.js"></script>
    <script  src="./scrollmagic/animation.gsap.js"></script>
    <script  src="./scrollmagic/debug.addIndicators.js"></script> -->



    <script>
        // init controller
        var controller = new ScrollMagic.Controller();
    </script>
</head>

<body>
    <div id="opening">
        <div id="triggerTurnRed" class="trigger"></div>
        <div id="triggerChangeQuote" class="trigger"></div>
        <div id="triggerIncarText" class="trigger"></div>
        <div id="triggerPinQuote" class="trigger"></div>
        <div id="triggerShake" class="trigger"></div>
        <div id="triggerPinMenu" class="trigger"></div>
        <div id="triggerZoomOutQuote" class="trigger"></div>


        <div id="menu">
            <img id="menu-img-strip" src="./incarnadine-strip1.jpg" />
        </div>
        <div id="opening-pin">
            <a class="scroll-indicator" id="scroll-indicator1"><span></span><span></span><span></span></a>
            <div id="quote-container" class="shake-constant">
                <div id="quote-hide-scaled-quote">
                    <div class="quote" id="quote-wash">Will all great Neptune's ocean wash this blood clean from my hands? </div>
                    <div class="quote" id="quote-incarnadine">No, these my hands will rather the multitudinous seas
                        <span id="text-incarnadine" class="shake-constant">incarnadine</span>.
                    </div>
                </div>
            </div>
            <img id="sea-img" src="./seas.jpg" />

            <div id="incar-img-wrapper">
                <img id="incarnadine-img" src="./incarnadine.jpg" />
            </div>

        </div>


    </div>

    <div id="view-modal"><h1>Content</h1></div>
    <script>
        const DEV_MODE = false;
        // scale of opening pinned scrolling scenes
        const SCROLL_SCALE = 2;

        // position of triggers
        const TRIGGER_TURN_RED_TOP = 1;
        const TRIGGER_CHANGE_QUOTE_TOP = 200 * SCROLL_SCALE;
        const CHANGE_QUOTE_END = 300 * SCROLL_SCALE;
        const TRIGGER_INCAR_TEXT_TOP = 350 * SCROLL_SCALE;
        // INCAR_TEXT_END = 450 * SCROLL_SCALE;
        const TURN_RED_END = 450 * SCROLL_SCALE;
        const SHAKE_TOGGLE = 460 * SCROLL_SCALE;

        // Percentage positions relative to the image
        const STRIP_HEIGHT = "7.4%"; // 80 : 1080
        const QUOTE_INITIAL = "15%";
        const SCROLL_INDICATOR_Y = "60%";
        const END_PIN_QUOTE = "55%";
        const MENU_STRIP = "63.5%";
        const FADE_DURATION = "36.5%";

        const SHAKE_ELEMENT = "#text-incarnadine";//"#quote-container";
        const INCAR_SHAKE_TYPE = "shake";

        // [...document.getElementsByClassName("quote")].forEach(element => {
        //     element.style.top = QUOTE_INITIAL;
        // });

        document.getElementById("quote-container").style.top = QUOTE_INITIAL;

        document.getElementById("triggerTurnRed").style.top = TRIGGER_TURN_RED_TOP + "px";
        document.getElementById("triggerChangeQuote").style.top = TRIGGER_CHANGE_QUOTE_TOP + "px";
        document.getElementById("triggerIncarText").style.top = TRIGGER_INCAR_TEXT_TOP + "px";
        document.getElementById("triggerPinQuote").style.top = TURN_RED_END + "px";
        document.getElementById("triggerShake").style.top = SHAKE_TOGGLE + "px";


        const incarnadineText = document.getElementById("text-incarnadine");

        // Set up the scene for incarnadining
        let sceneTurnRed = new ScrollMagic.Scene({
            triggerElement: "#triggerTurnRed",
            duration: TURN_RED_END - TRIGGER_TURN_RED_TOP,
            triggerHook: 0
        })
            // animate color and top border in relation to scroll position
            .setTween("#sea-img", { opacity: 0 }) // the tween durtion can be omitted and defaults to 1
            .setPin("#opening-pin", {
                pushFollowers: true
            })
            .addTo(controller);
        if (DEV_MODE === true) {
            sceneTurnRed.addIndicators({ name: "Turn red " }) // add indicators (requires plugin)
        }

        // Set up the scene for changing text
        let changeQuoteTimeline = new TimelineMax();
        changeQuoteTimeline
            .to("#quote-wash", { opacity: 0, zIndex: 2 })
            .to("#quote-incarnadine", { opacity: 1 });
        let sceneChangeQuote = new ScrollMagic.Scene({
            triggerElement: "#triggerChangeQuote",
            duration: CHANGE_QUOTE_END - TRIGGER_CHANGE_QUOTE_TOP,
            triggerHook: 0
        })
            .setTween(changeQuoteTimeline)
            // .setTween("#quote-wash", 1, { opacity: 0 })
            // .setTween("#quote-incarnadine", 1, { opacity: 1 })
            .addTo(controller);
        if (DEV_MODE === true) {
            sceneChangeQuote.addIndicators({ name: "Change quote " }) // add indicators (requires plugin)

        }

        // Set up the scene for incarnadine the word
        let sceneIncarText = new ScrollMagic.Scene({
            triggerElement: "#triggerIncarText",
            // duration: INCAR_TEXT_END - TRIGGER_INCAR_TEXT_TOP,
            triggerHook: 0
        })
            .setClassToggle("#text-incarnadine", "text-incarnadine-red")
            .addTo(controller);
        if (DEV_MODE === true) {
            sceneIncarText.addIndicators({ name: "Redden incarnadine" })

        }

        // When opening is unpinned, start pinning quote, shaking quote, and remove scroll indicator
        let scenePinQuote = new ScrollMagic.Scene({
            triggerElement: "#triggerPinQuote",
            duration: 0, // to be set by setPinQuoteDuration
            triggerHook: 0
        })
            .setTween("#scroll-indicator1", { opacity: 0 })
            .setPin("#quote-container")
            .addTo(controller);

        if (DEV_MODE === true) {
            scenePinQuote.addIndicators({ name: "Pin quote" });
        }

        let sceneShakeIncar = new ScrollMagic.Scene({
            triggerElement: "#triggerShake",
            triggerHook: 0
        })
        .setClassToggle(SHAKE_ELEMENT, INCAR_SHAKE_TYPE)
        .addTo(controller);
        if (DEV_MODE === true) {
            sceneShakeIncar.addIndicators({ name: "Shake" }); // add indicators (requires plugin)
        }

        // Pin menu beginning
        // let scenePinMenuBeginning = new ScrollMagic.Scene({
        //     triggerElement: "#triggerTurnRed",
        //     duration: TURN_RED_END - TRIGGER_TURN_RED_TOP,
        //     triggerHook: 0
        // })
        //     .setPin("#menu", {pushFollowers: false})
        //     .addTo(controller);

        // if (DEV_MODE === true) {
        //     scenePinMenuBeginning.addIndicators({ name: "Pin menu beginning" });
        // }

        // Show pinned menu
        let scenePinMenu = new ScrollMagic.Scene({
            triggerElement: "#triggerPinMenu",
            triggerHook: 0
        })
            // .setPin("#menu", {pushFollowers: false})
            .setClassToggle("#menu", "menu-show")
            .addTo(controller);

        if (DEV_MODE === true) {
            scenePinMenu.addIndicators({ name: "Pin menu" });
        }

        // Zoom out quote
        let zoomOutQuoteTimeline = new TimelineMax();
        zoomOutQuoteTimeline
            // .to("#quote-incarnadine", { opacity: 0 }, 0)
            .to("#quote-incarnadine", { scale: 1.5 }, 0);

        let sceneZoomOutQuote = new ScrollMagic.Scene({
            triggerElement: "#triggerZoomOutQuote",
            duration: 100, // to be set by setZoomOutQuoteDuration
            triggerHook: 0
        })
            .setTween(zoomOutQuoteTimeline)
            // .setClassToggle("#quote-incarnadine", "quote-incarnadine-none")
            .addTo(controller);
        if (DEV_MODE === true) {
            sceneZoomOutQuote.addIndicators({ name: "Zoom out quote" });
        }

        // Fade out picture, fade in view modal
        let fadeModalTimeline = new TimelineMax();
        fadeModalTimeline
            .to("#incarnadine-img", { opacity: 0 }, 0)
            .to("#view-modal", { opacity: 1 }, 0);

        let sceneFadeModal = new ScrollMagic.Scene({
            triggerElement: "#triggerPinMenu",
            duration: 100, // to be set by setPinQuoteDuration
            triggerHook: 0
        })
            .setTween(fadeModalTimeline)
            // .setClassToggle("#opening", "opening-light")
            .addTo(controller);
        if (DEV_MODE === true) {
            sceneFadeModal.addIndicators({ name: "Fade modal" });
        }





        // Dynamically set positions relative to image
        const seaImgElem = document.getElementById("sea-img");

        // change the duration of pin quote scene to correspond to the image height
        const calcPinQuoteDuration = () => {
            let result = seaImgElem.clientHeight
                * (parseFloat(END_PIN_QUOTE) - parseFloat(QUOTE_INITIAL)) / 100.0;
            return result;
        };
        const setPinQuoteDuration = () => {
            scenePinQuote.duration(calcPinQuoteDuration());
            scenePinQuote.refresh();
        };

        // change the top of scroll indicator to correspond to the image height
        const scrollIndicator = document.getElementById("scroll-indicator1");
        const calcScrollIndicatorPosition = () => {
            let result = seaImgElem.clientHeight
                * (parseFloat(SCROLL_INDICATOR_Y)) / 100.0;
            return result + "px";
        };
        const changeScrollIndicatorPosition = () => {
            scrollIndicator.style.top = calcScrollIndicatorPosition();
        }

        // change the top of menu to correspond to the image height
        // const menu = document.getElementById("menu");
        // const calcMenuPosition = () => {
        //     let relativeToImg = seaImgElem.clientHeight
        //         * (parseFloat(MENU_STRIP)) / 100.0;
        //     console.log("hi", relativeToImg);
        //     return relativeToImg + "px";
        // };
        // const changeMenuPosition = () => {
        //     menu.style.top = calcMenuPosition();
        // };

        // change the top of pin menu trigger
        const pinMenuTrigger = document.getElementById("triggerPinMenu");
        const calcPinMenuTriggerPosition = () => {
            let relativeToImg = seaImgElem.clientHeight
                * (parseFloat(MENU_STRIP)) / 100.0;
            // console.log("hi", TURN_RED_END - TRIGGER_TURN_RED_TOP);
            return TURN_RED_END - TRIGGER_TURN_RED_TOP + relativeToImg + "px";
        };
        const changePinMenuTrigger = () => {
            pinMenuTrigger.style.top = calcPinMenuTriggerPosition();
        };

        // const menuStrip = document.getElementById("menu-img-strip");
        const viewModal = document.getElementById("view-modal");
        const changeViewModalPaddingTop = () => {
            console.log(seaImgElem.clientHeight * (parseFloat(STRIP_HEIGHT)) / 100.0);
            viewModal.style.paddingTop = seaImgElem.clientHeight * (parseFloat(STRIP_HEIGHT)) / 100.0 + "px";
        };

        // change the top of zoom out quote trigger
        const zoomOutQuoteTrigger = document.getElementById("triggerZoomOutQuote");
        const calcZoomOutQuoteTriggerPosition = () => {
            return calcPinQuoteDuration() + TURN_RED_END + "px";
        };
        const changeZoomOutQuoteTrigger = () => {
            zoomOutQuoteTrigger.style.top = calcZoomOutQuoteTriggerPosition();
        };

        // change the duration of zoom out quote scene to correspond to the image height
        const calcZoomOutQuoteDuration = () => {
            let result = parseFloat(calcPinMenuTriggerPosition()) - parseFloat(calcZoomOutQuoteTriggerPosition());
            // console.log("ji", calcPinMenuTriggerPosition(), calcZoomOutQuoteTriggerPosition(), result);
            return result;
        };
        const setZoomOutQuoteDuration = () => {
            sceneZoomOutQuote.duration(calcZoomOutQuoteDuration());
            sceneZoomOutQuote.refresh();
        };

        // change the duration of fade modal scene to correspond to the image height
        const calcFadeModalDuration = () => {
            let result = seaImgElem.clientHeight
                * (parseFloat(FADE_DURATION)) / 100.0;
            console.log(result);
            return result;
        };
        const setFadeModalDuration = () => {
            sceneFadeModal.duration(calcFadeModalDuration());
            sceneFadeModal.refresh();
        };

        // setTimeout(()=>{document.getElementById("#quote-incarnadine").style.opacity=0;}, 200);
        new ResizeObserver(() => {
            // if (seaImgElem.clientHeight === 0) {
            //     return;
            // }
            setPinQuoteDuration();
            changeScrollIndicatorPosition();
            // changeMenuPosition();
            changePinMenuTrigger();
            changeZoomOutQuoteTrigger();
            setZoomOutQuoteDuration();
            changeViewModalPaddingTop();
            setFadeModalDuration();
        }).observe(seaImgElem);

    </script>
</body>

</html>